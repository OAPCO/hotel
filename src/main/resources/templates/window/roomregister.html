<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>객실 관리</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <link rel="stylesheet" href="/yhh.css">
</head>

<body>

    <div class="card">
        <div class="card-header">
            <div style="color:#44454e; font-size: 25px; margin-bottom: 10px">
                객실 등록
            </div>
            <form method="post" enctype="multipart/form-data" id="roomregisterform">
                <input type="hidden" name="roomCd" id="roomCd">

                <div class="table-responsive">
                <table class="table roomregister">

                    <thead>
                    <tr>

                        <th>객실명</th>
                        <td>
                            <input type="text" name="roomName" id="roomName">
                        </td>
                            <input type="hidden" th:value="${distDTO.distName}" name="distDTO.distName" readonly="readonly" style="background-color: #F0F0F0">

                        <th>호텔명</th>
                        <td>
                            <input type="text" th:value="${storeDTO.storeName}" name="storeDTO.storeName" readonly="readonly" style="background-color: #F0F0F0">
                            <input type="hidden" th:value="${storeDTO.storeIdx}" id="storeIdx" name="storeDTO.storeIdx">
                        </td>

                    </tr>
                    <tr>
                        <th>타입</th>
                        <td style="height: 140px">
                        <div>

                            <select class="form-select" id="roomType" onchange="toggleCustomInput()" name="">
                                <option value="">==</option>
                                <option th:each="roomTypeList : ${roomTypeList}" th:value="${roomTypeList.roomType}" th:text="${roomTypeList.roomType}"></option>
                                <option value="custom">[새로 추가]</option>
                            </select>
                            <div id="customRoomTypeContainer"></div>
<!--                            <div id="customRoomTypeInput" style="display: none;">-->
<!--                                <input type="text" class="form-control" placeholder="새 객실 타입" name="">-->
<!--                            </div>-->
                            <br>

                        </div>
                        </td>

                        <th>가격</th>
                        <td class="col>">
                            <input type="text" class="form-control" name="roomPrice" id="roomPrice">
                        </td>
                    </tr>


                    </thead>

                </table>

                    <span id="customRoomImageth">이미지 등록</span><br>
                    <span class="col>" id="customRoomImagetd">
                        대표 이미지  <input type="file" class="form-control" id="mainimgFile" name="mainimgFile">
                        세부 이미지  <input type="file" class="form-control" id="imgFile" name="imgFile" multiple>
                    </span>

                <div id="preview2"></div>
                <div id="preview"></div>

                <div style="text-align: center;">
                    <button type="submit" class="btn button">등록</button>
                    <button type="button" class="btn btn-secondary"
                            onclick="window.history.back()">이전</button>
                </div>

            </div>
            </form>
        </div>
    </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="/js/hotel.js"></script>
        <script>

            function toggleCustomInput() {
                var customRoomTypeContainer = document.getElementById('customRoomTypeContainer');

                var roomTypeSelect = document.getElementById('roomType');
                // var customRoomTypeInput = document.getElementById('customRoomTypeInput');
                var customRoomImagetd = document.getElementById('customRoomImagetd');
                var customRoomImageth = document.getElementById('customRoomImageth');
                var imgFile = document.getElementById('imgFile');
                var mainimgFile = document.getElementById('mainimgFile');

                var selectedValue = roomTypeSelect.value;

                customRoomTypeContainer.innerHTML = '';


                if (selectedValue === 'custom') {
                    // customRoomTypeInput.style.display = 'block';
                    customRoomImagetd.style.display = 'block';
                    customRoomImageth.style.display = 'block';
                    // customRoomTypeInput.name = 'roomType';



                    // Create the input element
                    var customRoomTypeInput = document.createElement('input');
                    customRoomTypeInput.type = 'text';
                    customRoomTypeInput.className = 'form-control';
                    customRoomTypeInput.placeholder = '새 객실 타입';
                    customRoomTypeInput.name = 'roomType';

                    // Append the input element to the container
                    customRoomTypeContainer.appendChild(customRoomTypeInput);



                    roomTypeSelect.name = '';


                    document.getElementById('roomregisterform').action = '/window/roomregister';

                    document.getElementById('preview').value = null;
                    document.getElementById('preview2').value = null;
                    document.getElementById('roomPrice').value = null;
                    document.getElementById('roomPrice').readOnly = false;


                    imgFile.required = true;
                    mainimgFile.required = true;


                    preview.innerHTML = '';
                    preview2.innerHTML = '';

                } else {

                    // customRoomTypeInput.style.display = 'none';
                    customRoomImagetd.style.display = 'none';
                    customRoomImageth.style.display = 'none';
                    // customRoomTypeInput.name = '';
                    roomTypeSelect.name = 'roomType';
                    // console.log(customRoomTypeInput.name);
                    console.log(roomTypeSelect.name);
                    document.getElementById('roomPrice').readOnly = true;
                    document.getElementById('roomregisterform').action = '/window/roomregisteradd';
                    console.log(document.getElementById('roomregisterform').action);


                    //이 자리에 객실타입의 이미지, 객실타입의 정보 불러오기
                    var searchDTO = {
                        roomType : $('#roomType').val(),
                        storeIdx: $('#storeIdx').val()
                    };

                    var roomType2 = $('#roomType').val();
                    var storeIdx2 = $('#storeIdx').val();

                    console.log(roomType2);
                    console.log(storeIdx2);

                    imgFile.required = false;
                    mainimgFile.required = false;


                    const roomImages = hotel.searchRoomTypeImage(searchDTO);
                    const roomData = hotel.searchRoomTypeData(roomType2,storeIdx2);


                }
            }


            const input = document.getElementById('imgFile');
            const input2 = document.getElementById('mainimgFile');
            const preview = document.getElementById('preview');
            const preview2 = document.getElementById('preview2');
            const roomregisterform = document.getElementById('roomregisterform');

            input.addEventListener('change', function() {
                preview.innerHTML = ''; // 이미지 미리보기 초기화

                const files = this.files;
                for (const file of files) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.maxWidth = '200px'; // 이미지 최대 너비 설정
                        img.style.marginRight = '10px'; // 이미지 간격 설정
                        preview.appendChild(img);
                    }

                    reader.readAsDataURL(file);
                }
            });

            input2.addEventListener('change', function() {
                preview2.innerHTML = ''; // 이미지 미리보기 초기화

                const files = this.files;
                for (const file of files) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.style.maxWidth = '200px'; // 이미지 최대 너비 설정
                        img.style.marginRight = '10px'; // 이미지 간격 설정
                        preview2.appendChild(img);
                    }

                    reader.readAsDataURL(file);
                }
            });

            //부모창에서 가져온 카드의 id 값 추출해서 roomCd에 집어넣음
            var urlParams = new URLSearchParams(window.location.search);
            var roomCd = urlParams.get('id');
            console.log(roomCd);

            //자리 값을 roomCd 인풋(히든)에 넣음
            var roomCdInput = document.getElementById('roomCd');
            roomCdInput.value = roomCd;
            console.log(roomCdInput);




        </script>

</body>
</html>
