<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mypagelayout}">
<head>
    <title>포인트내역</title>


</head>
<body>
<div layout:fragment="content">
    <div class="container-fluid" style="max-width: 80%;">
        <div>
            <h3 style="padding-left: 210px;">포인트 적립내역</h3>
            <table style="max-width: 100%; align-content: center">
                <thead>
                <tr>
                    <th>적립명</th>
                    <th>적립액</th>
                    <th>적립,사용</th>
                    <th>날짜</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="reward : ${memberDTO.rewardList}">
                    <td th:text="${reward.rewardName}">비빔밥</td>
                    <td th:text="${reward.rewardAmount}">15,000</td>
                    <td th:text="${reward.rewardPM}"></td>
                    <td th:text="${#strings.substringBefore(reward.regdate, 'T')}">2024-05-22</td>
                </tr>
                </tbody>
            </table>
            <hr style="height:1px; border:none; color:#ccc; background-color:#ccc;">
            <div style="text-align: right; margin-right: 10%; padding-top: 10px;">
                총 적립액 : <span id="rewardtotal">500원</span>
            </div>
        </div>
        <p></p>
        <div style="padding-top: 20px;">
            <h3 style="padding-left: 210px;">쿠폰</h3>
            <table style="max-width: 100%; align-content: center">
                <thead>
                <tr>
                    <th>쿠폰명</th>
                    <th>할인 가격</th>
                    <th>사용처</th>
                    <th>사용 여부</th>
                    <th>날짜</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="coupon : ${memberDTO.couponList}">
                    <td th:text="${coupon.couponName}">첫 가입 기념 쿠폰</td>
                    <td th:text="${coupon.couponPrice}">5,000원 할인</td>
                    <td th:text="${coupon.detail}">메뉴 주문 시</td>
                    <td th:text="${coupon.couponState}">미사용</td>
                    <td th:text="${#strings.substringBefore(coupon.regdate, 'T')}">2024-05-22</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', (event) => {
            const rewards = /*[[${memberDTO.rewardList}]]*/ [];
            let total = 0;
            for (let reward of rewards) {
                if (reward.rewardPM === '사용') {
                    total -= reward.rewardAmount;
                } else {
                    total += reward.rewardAmount;
                }
            }
            document.getElementById("rewardtotal").innerText = total + "원";
        });
        /*]]>*/
    </script>
</div>
</body>
</html>
