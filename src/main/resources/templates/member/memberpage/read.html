<!DOCTYPE html>
<html data-bs-theme="light" lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/memberread}">

<head>
    <title>매장 안내</title>
    <link rel="stylesheet" href="/yhh.css">
    <style>
        .star-rating {
            unicode-bidi: bidi-override;
            direction: rtl;
            text-align: left;
        }

        .star {
            display: inline-block;
            width: 20px; /* 별 한 개의 너비 */
            overflow: hidden;
            white-space: nowrap;
        }

        .star::before {
            content: "\2605"; /* 별 모양 */
        }

        .star-filled {
            color: orange; /* 채워진 별의 색 */
        }

        .star-empty {
            color: gray; /* 비어있는 별의 색 */
        }

        .darkroom {
            background-color: #696969; /* 원하는 어두운 색으로 설정 */

        }
        .normalroom {
            background-color: #ffffff; /* 원하는 밝은 색으로 설정 */
            /* search-container를 flex로 설정하고 요소들을 중앙에 정렬합니다. */
            .search-container {
                padding-top: 25px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;  /* 추가로 요소들 사이의 간격을 조정했습니다. */
            }
            /* .search-inputs와 .search-box를 flex로 설정하고 요소들을 가로로 정렬합니다. 이들의 너비는 상위 컨테이너인 search-container의 50%입니다. */
            .search-inputs, .search-box {
                display: flex;
                width: 50%;
                justify-content: space-between;
                gap: 0;  /* 요소들 사이의 간격을 없애기 위해 0으로 설정합니다. */
                align-items: center; /* 이 코드를 추가하여 요소들이 동일한 기준선에 정렬되게 합니다. */

                /* 각 input, select, button 요소의 높이를 50px로 설정하고, 모서리를 각진 형태로 만듭니다. */
                select, input[type="date"], .form-control, .btn {
                    height: 100px;
                    border-radius: 0;
                    border: none; /* 추가하면 브라우저 기본 스타일을 제거하여 높이를 정확히 조정할 수 있습니다. */
                    box-sizing: border-box; /* 이건 전체 너비를 정확하게 계산합니다(패딩과 경계 포함). */
                }
            }

            /* .search-box 내의 input 요소와 button 요소에 flex 속성을 추가해 일관된 너비를 유지합니다. */
            .search-box .form-control {
                flex: 8;

            }
        }
        .select-box {
            border: 1px solid #ccc;
            width: 200px;
            padding: 10px;
            border-radius: 5px;
            position: relative;
            cursor: pointer;
        }

        .selected {
            padding: 5px 0;
        }

        .options {
            display: none;
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            border: 1px solid #ccc;
            background-color: #fff;
            border-radius: 5px;
            z-index: 10;
        }

        .option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            cursor: default;
        }

        .option:hover {
            background-color: #f0f0f0;
        }

        button.minus, button.plus {
            font-weight: bold;
            color: #333;
            width: 30px;
            height: 30px;
            border: none;
            background-color: #f0f0f0;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button.minus:hover, button.plus:hover {
            background-color: #ddd;
        }

        .label {
            flex-grow: 1;
            text-align: center;
        }
        .bdline {
            border: 1px solid #ccc; /* 회색 테두리 */
        }


    </style>

</head>

<body>
<div layout:fragment="content">



    <div id="section1" class="container-fluid pt-5">
        <!-- 매장 정보 -->
        <div class="container" style="margin: auto; width: 80%;">
            <div class="card bdline">
                <div class="card-header py-3">
                    <div class="sub_title">
                        <h2 th:text="${storeDTO.storeName}">매장 안내 </h2>
                        <p>Store information</p>
                        <span th:text="${storeDTO.storeSummary}">동해와 설악의 청정한 자연과 스페인의 건축 미학이 깃든 리조트의 만남!<br>
자연과 하나되는 고품격 리조트에서 지중해 스페인의 멋과 낭만을 경험할 수 있을 것 입니다.<br>
또한 고객의 마음을 헤아리는 품격 높은 서비스로 달콤하고 아늑한 휴식을 즐길 수 있을 것 입니다.
                        <br>
                    </span>
                    </div>
                </div>
                <div class="card-body text-center">
                    <table class="table text-center" style="margin-top: 50px; margin-left: 55px">
                        <tbody>
                        <tr>
                            <img th:src="|https://${bucket}.s3.${region}.amazonaws.com/${folder}%5c${storeDTO.storeimgName}|"
                                 width="1000" height="600" style="border-radius: 10px;">
                        </tr>
                        <tr class="row">
                            <td class="col-2 ">영업시간</td>
                            <td class="col-9">
                                <div>영업 시작: <input type="time" value="${storeDTO.storeOpenTime}" disabled> ~ 영업 끝:
                                    <input type="time" value="${storeDTO.storeCloseTime}" disabled></div>
                            </td>
                        </tr>
                        <tr class="row">
                            <td class="col-2">편의시설</td>
                            <td class="col-9" th:text="${storeDTO.facilities}">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div> <!-- 매장 상세 정보 -->
    </div>
    <p></p>
    <div id="section2" class="container bdline" style="margin: auto; width: 80%; border-radius: 10px;">
        <div style="display: flex; justify-content: space-between; margin: auto; width: 100%;">
            <!-- 리뷰와 별점 정보 -->
            <div style="flex-basis: 33%; padding-right: 10px; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);">
                <div>
                    <h2 style="margin: 0; padding: 16px; background-color: #f8f9fa;">리뷰 및 별점</h2>
                    <div style="padding: 16px; display: flex; align-items: center;">
                        <h4 style="margin-right: 8px;">평균 별점:</h4>
                        <div class="star-rating" style="display: inline-block;">
                            <span class="star star1"></span>
                            <span class="star star2"></span>
                            <span class="star star3"></span>
                            <span class="star star4"></span>
                            <span class="star star5"></span>
                        </div>
                    </div>
                    <!-- 캐러셀 아이템들을 담을 div -->
                    <div id="review-carousel" class="carousel slide" data-ride="carousel" style="padding-top: 35%;">
                        <div class="carousel-inner" style="text-align: center; display: flex; overflow: hidden;">
                            <div th:if="${#lists.isEmpty(reviewList)}"
                                 style="flex: 0 0 100%; max-width: 100%; display: flex; flex-direction: column; align-items: center;">
                                <p style="font-size: 14px; text-align: center; color: #333;">리뷰가 없습니다.</p>
                            </div>
                            <!-- 타임리프를 사용하여 동적으로 리뷰 데이터를 반복하여 표시 -->
                            <div class="carousel-item" th:each="review, iterStat : ${reviewList}"
                                 th:classappend="${iterStat.first} ? 'active'" th:if="${!#lists.isEmpty(reviewList)}" style="flex: 0 0 100%; max-width:
                                 100%;">
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <div class="star-rating" style="margin-bottom: 10px;">
                                        <span class="star">&#9733;</span>
                                        <span class="star">&#9733;</span>
                                        <span class="star">&#9733;</span>
                                        <span class="star">&#9733;</span>
                                        <span class="star">&#9733;</span>
                                    </div>
                                    <p th:text="${review.text}" style="font-size: 14px; text-align: center; color: #333;"></p>
                                    <p>
                                        <span th:text="${#strings.substring(review.memberEmail, 0, 5) + '@*****.***'}" style="font-size: 10px; color: #666;"></span>
                                        <span style="font-size: 10px; color: #666;">님이 남긴 후기입니다</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 지도 -->
            <div id="map" style="flex-basis: 67%; height: 600px;"></div>
        </div>
    </div>
    <p></p>
    <div id="section3" class="container-fluid pt-5">

        <div class="container" style="margin: auto; width: 80%;">
            <div class="card bdline" style="width: 100%; max-width: 100%; margin-bottom: 20px; background-color: #fff;
            border-radius: 10px; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);"
                 th:each="roomTypeListView : ${roomTypeList}">

                <div style="display: flex; margin-left:2%">
                    <!-- 왼쪽 이미지 -->
                    <div th:id="'carousel' + ${roomTypeListView.roomIdx}" class="carousel slide" data-bs-ride="carousel">

                        <div class="carousel-inner bdline">

                            <div th:each="roomImageListView : ${roomImageList}" th:if="${roomImageListView.roomImageType == roomTypeListView.roomType}">

<!--                                <img th:src="|https://${bucket}.s3.${region}.amazonaws.com/${folder}%5c${roomImageListView.imgName}|" width="700" height="400" alt="Slide"/>-->


                                <div th:attr="class=${roomImageListView.roomImageMain == 1 ? 'carousel-item active' : 'carousel-item'}">
                                    <img th:src="|https://${bucket}.s3.${region}.amazonaws.com/${folder}%5c${roomImageListView.imgName}|" width="700" height="400"
                                         alt="Slide"/>
                                </div>

                                <div th:attr="class=${roomImageListView.roomImageType}">
                                    <a class="carousel-control-prev" th:href="'#carousel' + ${roomTypeListView.roomIdx}" role="button" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </a>
                                    <a class="carousel-control-next" th:href="'#carousel' + ${roomTypeListView.roomIdx}" role="button" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Next</span>
                                    </a>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>

                <!-- 오른쪽 정보 -->
                <div style="flex: 1; padding: 20px; display: flex; flex-direction: column; justify-content: space-between;">
                    <p style="margin: 0; font-size: 16px; text-align: right; font-weight: bold; font-size: 35px;"
                       th:text="${roomTypeListView.roomType}"></p>
                </div>

            </div>
        </div>

    </div>
    <p></p>
    <div class="container-fluid pt-5">
        <!-- 매장 정보 -->
        <div class="container" style="margin: auto; width: 80%;">
            <div class="card bdline">
                <div class="card-header py-3">
                    <h3>조회</h3>
                </div>
                <div class="card-body">
                    <form id="emptyRoomForm">
                        <table style="width: 100%;">

                            <tbody>
                            <tr>
                                <td class="col-1" style="text-align: center;">
                                    체크인 :
                                </td>
                                <td class="col-3">
                                    <input type="date" name="reservationDateCheckin"  style=" width:300px; border-radius: 10px; height: 50px; padding-top: 5px; position: relative;" id="isoStartDate">
                                </td>
                                <td class="col-1" style="text-align: center;">
                                    체크아웃 :
                                </td>
                                <td class="col-3" >
                                    <input type="date" name="reservationDateCheckout"  style=" width:300px; border-radius: 10px; height: 50px; padding-top: 5px; position: relative;" id="isoEndDate">
                                </td>
                                <input type="hidden" id="storeIdx" name="storeIdx" th:value="${storeDTO.storeIdx}">
                                <td class="col-3">
                                    <button class="btn btn-primary" type="submit" style=" margin-top:50px; margin-bottom:50px; margin-left:100px;  white-space: nowrap; ">조회하기</button>
                                </td>
                            </tr>


                            </tbody>
                                <tr>

                            </tr>
                        </table>
                    </form>


                    <div class="table-responsive" id="emptyRoomSearchResult">

                        <form action="/member/memberpage/paypage" method="post" id="reservationForm">

                            <input type="hidden" id="reservationDateCheckinResult" name="reservationDateCheckin">
                            <input type="hidden" id="reservationDateCheckOutResult" name="reservationDateCheckout">
                            <input type="hidden" name="storeIdx" th:value="${storeDTO.storeIdx}">
                            <input type="hidden" name="memberIdx" th:value="${memberDTO.memberIdx}">
                            <input type="hidden" name="memberName" th:value="${memberDTO.memberName}">
                            <input type="hidden" name="roomOrderType" id="selectedRoomOrderType"></td>
                            <input type="hidden" name="roomIdx" id="selectedRoomIdx">
                            <input type="hidden" name="roomPrice" id="selectedRoomOrderPrice">
                        <table class="table body">

                            <thead>
                            <tr>
                                <th colspan="3">조회결과</th>
                            </tr>
                            </thead>

                            <tbody id="emptyRoomResultTable">



                            </tbody>

                        </table>

                        </form>

                    </div>



                </div>
            </div>
        </div> <!-- 매장 상세 정보 -->
    </div>
    <p></p>
    <div id="roomImageModal" class="modal">
        <!-- 모달 내용 -->
        <div class="modal-content">
            <p>모달 내용을 여기에 넣으세요.</p>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/hotel.js"></script>
    <script>
        $(document).ready(function () {
            $('#review-carousel').carousel(); // 기존의 carousel 초기화

            // 슬라이드 이동 시 이벤트 처리
            $('#review-carousel').on('slid.bs.carousel', function () {
                // 현재 활성화된 슬라이드 인덱스
                var currentIndex = $(this).find('.active').index();
                // 슬라이드 총 개수
                var totalSlides = $(this).find('.carousel-item').length;

                // 현재 슬라이드가 마지막 슬라이드라면
                if (currentIndex === totalSlides - 1) {
                    // 3초 후에 첫 번째 슬라이드로 이동
                    setTimeout(function () {
                        $('#review-carousel').carousel(0);
                    }, 3000);
                }
            });
        });

    </script>
    <script>

        // document.addEventListener('click', function(event) {
        //     const selectBox = document.querySelector('.select-box');
        //     const options = document.querySelector('.options');
        //     if (!selectBox.contains(event.target)) {
        //         options.style.display = 'none';
        //     }
        // });
    </script>
    <script>
        // 현재 날짜를 'YYYY-MM-DD' 형식으로 반환하는 함수
        function getCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더함
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 주어진 날짜의 하루 후를 'YYYY-MM-DD' 형식으로 반환하는 함수
        function getNextDate(dateString) {
            const date = new Date(dateString);
            date.setDate(date.getDate() + 1); // 하루를 더함
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 현재 날짜를 isoStartDate의 최소 날짜로 설정
        document.getElementById('isoStartDate').min = getCurrentDate();
        document.getElementById('isoEndDate').min = getNextDate(getCurrentDate());

        // isoStartDate의 값이 변경될 때 isoEndDate의 최소 날짜를 설정하고 활성화/비활성화 처리
        document.getElementById('isoStartDate').addEventListener('change', function() {
            const startDate = this.value;
            const isoEndDate = document.getElementById('isoEndDate');

            if (startDate) {
                isoEndDate.min = getNextDate(startDate);
                isoEndDate.disabled = false; // isoStartDate가 선택되면 isoEndDate를 활성화
            } else {
                isoEndDate.min = '';
                isoEndDate.disabled = true; // isoStartDate가 선택되지 않으면 isoEndDate를 비활성화
            }
        });
    </script>


    <script>


        //빈 방 찾기
        $('#emptyRoomForm').on('submit', function (event) {

            //폼 제출시 페이지 리로드 등을 방지하고 자바스크립트를 실행하기 위해 추가
            event.preventDefault();


            //필요한 값을 searchDTO에 담아서 보냄
            var searchDTO = {
                reservationDateCheckin: $('#isoStartDate').val(),
                reservationDateCheckout: $('#isoEndDate').val(),
                storeIdx: $('#storeIdx').val()
            };

            console.log("여기는 잘 찍히느거 확인"+searchDTO.reservationDateCheckin);
            console.log("여기는 잘 찍히느거 확인"+searchDTO.reservationDateCheckout);
            console.log("여기는 잘 찍히느거 확인"+searchDTO.storeIdx);

            //빈 객실 찾는 ajax 실행
            hotel.searchEmptyRoom(searchDTO);


        });



    </script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=bd90249e2dbb2fcc6c57d447c2e9f414&libraries=services,clusterer,drawing"></script>

    <script th:inline="javascript">
        let storeAddr = /*[[${storeDTO.storeAddr}]]*/ '제주특별자치도 제주시 첨단로 242';
        let storePhone = /*[[${storeDTO.storeTel}]]*/ '010-1111-1111';
        let storeName = /*[[${storeDTO.storeName}]]*/ '쓰레기매장';
        // 주소-좌표 변환 객체를 생성합니다
        var geocoder = new kakao.maps.services.Geocoder();

        // 주소로 좌표를 검색합니다
        geocoder.addressSearch(storeAddr, function(result, status) {
            // 정상적으로 검색이 완료됐으면
            if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                    mapOption = {
                        center: coords, // 지도의 중심좌표 - 검색된 주소의 좌표
                        level: 3 // 지도의 확대 레벨
                    };

                // 지도를 생성합니다
                var map = new kakao.maps.Map(mapContainer, mapOption);

                // 검색된 주소의 마커와 인포윈도우 생성
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: coords
                });

                var infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="width:150px;text-align:center;padding:6px 0;">${storeName}</div>`
                });
                infowindow.open(map, marker);

                // 장소 검색 객체를 생성합니다
                var ps = new kakao.maps.services.Places();

                // 카테고리(관광명소)를 검색합니다
                ps.categorySearch('AT4', function (data, status, pagination) {
                    if (status === kakao.maps.services.Status.OK) {
                        data.slice(0, 5).forEach((place) => {
                            displayMarker(place);
                        });
                    }
                }, {location: coords});

                function displayMarker(place) {
                    // 마커를 생성하고 지도에 표시합니다
                    var placeMarker = new kakao.maps.Marker({
                        map: map,
                        position: new kakao.maps.LatLng(place.y, place.x)
                    });

                    // 마커에 클릭이벤트를 등록합니다
                    kakao.maps.event.addListener(placeMarker, 'click', function() {
                        document.getElementById('place-name').innerText = place.place_name; // 장소명
                        document.getElementById('place-addr').innerText = place.address_name; // 장소 주소
                        document.getElementById('place-tel').innerText = place.phone; // 장소 전화번호
                    });
                }

                // 페이지 로드 시 storeDTO.addr의 정보를 place-name 및 place-addr에 적용
                document.getElementById('place-name').innerText = storeAddr;
                document.getElementById('place-addr').innerText = coords;
                document.getElementById('place-tel').innerText = storePhone;

            }
        });
        // averageRating 변수에 평균 별점 값이 들어있다고 가정합니다.
        var averageRating = 4; // 예시 평균 별점

        // 평균 별점을 계산하여 각 별에 클래스를 추가합니다.
        for (var i = 1; i <= 5; i++) {
            var star = document.querySelector('.star' + i);
            if (i <= averageRating) {
                star.classList.add('star-filled');
            } else {
                star.classList.add('star-empty');
            }
        }
    </script>

</div>
<p></p>


</div>
</body>
</html>